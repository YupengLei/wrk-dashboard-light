{"ast":null,"code":"import _classCallCheck from\"/Users/yupenglei/Documents/wrk-dashboard-light/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/yupenglei/Documents/wrk-dashboard-light/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/yupenglei/Documents/wrk-dashboard-light/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/yupenglei/Documents/wrk-dashboard-light/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from\"react\";import*as d3 from\"d3\";import concernData from\"../../data/safety_WRK_survey_2021.csv\";import{ChartHeader,ChartFooter,ChartContainer}from\"../housing/availableUnits\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Concern=/*#__PURE__*/function(_React$Component){_inherits(Concern,_React$Component);var _super=_createSuper(Concern);function Concern(){var _this;_classCallCheck(this,Concern);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.componentDidMount=function(){_this.drawConcern();};_this.componentDidUpdate=function(){d3.select(\"svg\").remove();_this.drawConcern();};_this.drawConcern=function(){//set svg size\nvar w=1000;var h=500;var padding=20;var leftMargin=400;var dataset=[],xScale,yScale,xAxis,yAxis;//loading data from csv file\nd3.csv(concernData).then(function(data){dataset=data;dataset.sort(function(a,b){return a.yes-b.yes;});//construct a band scale with specified domain and range\nyScale=d3.scaleBand().domain(dataset.map(function(d){return d.var_label;})).range([h-padding,padding]).paddingInner(0.8);//construct a continuous scale with specified domain and range\nxScale=d3.scaleLinear().domain([0,0.8]).range([leftMargin,w-padding]);//construct a left-oriented axis generator for the given scale\nyAxis=d3.axisLeft().scale(yScale);//construct a top-oriented axis generator for the given scale\nxAxis=d3.axisTop().scale(xScale).tickFormat(d3.format(\".0%\")).ticks(5);//create svg element\nvar svg=d3.select(_this.props.concernRef.current).append(\"svg\").attr(\"width\",w).attr(\"height\",h);//create rect element and load dataset\nvar rect=svg.selectAll(\"rect\").data(dataset).enter().append(\"rect\");rect.attr(\"x\",leftMargin).attr(\"y\",function(d){return yScale(d.var_label);}).attr(\"width\",0).attr(\"height\",yScale.bandwidth()).attr(\"fill\",function(d){return\"#a8ddb5\";}).transition().duration(700).delay(function(d,i){return i*300;}).attr(\"width\",function(d){return xScale(d.yes/d.total_participants)-leftMargin;});//Create axis-x and axis-y\nsvg.append(\"g\").attr(\"class\",\"axis-x-concern\").attr(\"transform\",\"translate(0, \".concat(padding,\")\")).attr(\"color\",\"#555\").call(xAxis).selectAll(\"text\").attr(\"font-size\",\"15px\").attr(\"color\",\"#000\");svg.append(\"g\").attr(\"class\",\"axis-y-concern\").attr(\"transform\",\"translate(\".concat(leftMargin,\", 0)\")).attr(\"color\",\"#555\").call(yAxis).selectAll(\"text\").attr(\"font-size\",\"15px\").attr(\"color\",\"#000\");//define sortBars function to sort bars \nvar sortOrder=false;var sortBars=function sortBars(){sortOrder=!sortOrder;dataset.sort(function(a,b){return sortOrder?b.yes-a.yes:a.yes-b.yes;});console.log(dataset);yScale.domain(dataset.map(function(d){return d.var_label;}));d3.select(\".axis-y-concern\").transition(\"yAxis\").delay(function(d,i){return i*10;}).duration(500).call(yAxis);rect.transition(\"sortBars\").delay(function(d,i){return i*10;}).duration(500).attr(\"y\",function(d){return yScale(d.var_label);});};//define event listeners for click, mouseover, mouseout\nrect.on(\"click\",function(){return sortBars();}).on(\"mouseover\",function(event,d){d3.select(event.currentTarget).attr(\"fill\",\"#fd8d3c\");d3.select(\"#concern\").style(\"left\",event.pageX+\"px\").style(\"top\",event.pageY+\"px\").select(\"#value\").text(d3.format(\".1%\")(d.yes/d.total_participants));d3.select(\"#concern\").select(\"#year\").text(d.var_label);d3.select(\"#concern\").classed(\"hidden\",false);}).on(\"mouseout\",function(event,d){d3.select(event.currentTarget).transition(\"restoreBarColor\").duration(250).attr(\"fill\",function(d){return\"#a8ddb5\";});d3.select(\"#concern\").classed(\"hidden\",true);});}).catch(function(error){console.log(error);});};return _this;}_createClass(Concern,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"div\",{className:\"concern-units\",style:{display:this.props.selectedStatsID===2?\"block\":\"none\"},children:[/*#__PURE__*/_jsx(ChartHeader,{chartTitle:\"What are the safety concerns in the community?\",dotColor:\"#a8ddb5\"}),/*#__PURE__*/_jsx(ChartContainer,{containerRef:this.props.concernRef,tooltipID:\"concern\",tooltipValueTitle:\"percentage\",tooltipOption:\"change\",display:\"none\"}),/*#__PURE__*/_jsx(ChartFooter,{chartSource:\"2020 Resident Survey.\"})]});}}]);return Concern;}(React.Component);export{Concern as default};","map":{"version":3,"names":["React","d3","concernData","ChartHeader","ChartFooter","ChartContainer","Concern","componentDidMount","drawConcern","componentDidUpdate","select","remove","w","h","padding","leftMargin","dataset","xScale","yScale","xAxis","yAxis","csv","then","data","sort","a","b","yes","scaleBand","domain","map","d","var_label","range","paddingInner","scaleLinear","axisLeft","scale","axisTop","tickFormat","format","ticks","svg","props","concernRef","current","append","attr","rect","selectAll","enter","bandwidth","transition","duration","delay","i","total_participants","call","sortOrder","sortBars","console","log","on","event","currentTarget","style","pageX","pageY","text","classed","catch","error","display","selectedStatsID","Component"],"sources":["/Users/yupenglei/Documents/wrk-dashboard-light/src/component/safety/concern.js"],"sourcesContent":["import React from \"react\";\nimport * as d3 from \"d3\";\nimport concernData from \"../../data/safety_WRK_survey_2021.csv\";\nimport { ChartHeader, ChartFooter, ChartContainer } from \"../housing/availableUnits\";\n\nexport default class Concern extends React.Component {\n\n    componentDidMount = () => {\n        this.drawConcern();\n    }\n\n    componentDidUpdate = () => {\n        d3.select(\"svg\").remove();\n        this.drawConcern();\n    }\n\n    drawConcern = () => {\n        //set svg size\n        let w = 1000;\n        let h = 500;\n        let padding = 20;\n        let leftMargin = 400;\n\n\n        let dataset = [], xScale, yScale, xAxis, yAxis;\n        //loading data from csv file\n        d3.csv(concernData).then(data => {  \n\n            dataset = data;\n            dataset.sort((a, b) => a.yes - b.yes);\n\n            //construct a band scale with specified domain and range\n            yScale = d3.scaleBand()\n                        .domain(dataset.map(d => d.var_label))\n                        .range([h - padding, padding])\n                        .paddingInner(0.8);\n                                \n            //construct a continuous scale with specified domain and range\n            xScale = d3.scaleLinear()\n                        .domain([0, 0.8])\n                        .range([leftMargin, w - padding])                                       \n\n            //construct a left-oriented axis generator for the given scale\n            yAxis = d3.axisLeft()\n                        .scale(yScale);\n\n            //construct a top-oriented axis generator for the given scale\n            xAxis = d3.axisTop()\n                        .scale(xScale)\n                        .tickFormat(d3.format(\".0%\"))\n                        .ticks(5);                            \n            \n            //create svg element\n            let svg = d3.select(this.props.concernRef.current)\n                        .append(\"svg\")\n                        .attr(\"width\", w)\n                        .attr(\"height\", h);  \n\n            //create rect element and load dataset\n            let rect = svg.selectAll(\"rect\")\n                            .data(dataset)\n                            .enter()\n                            .append(\"rect\");\n\n            rect.attr(\"x\", leftMargin)\n                .attr(\"y\", d => yScale(d.var_label))\n                .attr(\"width\", 0)\n                .attr(\"height\", yScale.bandwidth())\n                .attr(\"fill\", d => \"#a8ddb5\")\n                .transition()\n                    .duration(700)\n                    .delay((d, i) => i * 300)\n                    .attr(\"width\", d => xScale(d.yes / d.total_participants) - leftMargin);\n\n\n            //Create axis-x and axis-y\n            svg.append(\"g\")\n                .attr(\"class\", \"axis-x-concern\")\n                .attr(\"transform\", `translate(0, ${padding})`)\n                .attr(\"color\", \"#555\")\n                .call(xAxis)\n                .selectAll(\"text\")\n                .attr(\"font-size\", \"15px\")\n                .attr(\"color\", \"#000\")\n     \n            svg.append(\"g\")\n                .attr(\"class\", \"axis-y-concern\")\n                .attr(\"transform\", `translate(${leftMargin}, 0)`)\n                .attr(\"color\", \"#555\")\n                .call(yAxis)\n                .selectAll(\"text\")\n                .attr(\"font-size\", \"15px\")\n                .attr(\"color\", \"#000\");\n\n\n            //define sortBars function to sort bars \n            let sortOrder = false;\n            const sortBars = () => {\n                sortOrder = !sortOrder; \n                dataset.sort((a, b) => sortOrder ? b.yes - a.yes : a.yes - b.yes);\n                console.log(dataset)\n                yScale.domain(dataset.map(d => d.var_label));\n\n                d3.select(\".axis-y-concern\")\n                    .transition(\"yAxis\")\n                    .delay((d, i) => i * 10)\n                    .duration(500)\n                    .call(yAxis);\n\n                rect.transition(\"sortBars\")\n                    .delay((d, i) => i * 10)\n                    .duration(500)\n                    .attr(\"y\", d => yScale(d.var_label));\n\n            }\n\n            //define event listeners for click, mouseover, mouseout\n            rect.on(\"click\", () => sortBars())\n                .on(\"mouseover\", (event, d) => {\n\n                        d3.select(event.currentTarget)\n                            .attr(\"fill\", \"#fd8d3c\");\n\n                        d3.select(\"#concern\")\n                            .style(\"left\", event.pageX + \"px\")\n                            .style(\"top\", event.pageY + \"px\")\n                            .select(\"#value\")\n                            .text(d3.format(\".1%\")(d.yes / d.total_participants));\n\n                        d3.select(\"#concern\")\n                            .select(\"#year\")\n                            .text(d.var_label);\n                            \n                        d3.select(\"#concern\").classed(\"hidden\", false);\n\n                    })\n                    .on(\"mouseout\", (event, d) => {\n                        d3.select(event.currentTarget)\n                            .transition(\"restoreBarColor\")\n                            .duration(250)\n                            .attr(\"fill\",  d => \"#a8ddb5\");\n\n                        d3.select(\"#concern\").classed(\"hidden\", true);\n                    });\n            \n\n        }).catch((error) => {\n            console.log(error);\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"concern-units\" style={{display: this.props.selectedStatsID === 2 ? \"block\" : \"none\"}} >\n                <ChartHeader \n                    chartTitle=\"What are the safety concerns in the community?\"\n                    dotColor=\"#a8ddb5\"\n                />\n                <ChartContainer \n                    containerRef={this.props.concernRef} \n                    tooltipID=\"concern\"\n                    tooltipValueTitle=\"percentage\"\n                    tooltipOption=\"change\"\n                    display=\"none\"\n                />\n                <ChartFooter chartSource=\"2020 Resident Survey.\" />\n            </div>\n        );\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}