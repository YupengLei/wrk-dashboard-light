{"ast":null,"code":"var _jsxFileName = \"/Users/yupenglei/Documents/wrk-dashboard-light/src/component/safety/concern.js\";\nimport React from \"react\";\nimport * as d3 from \"d3\";\nimport concernData from \"../../data/safety_WRK_survey_2021.csv\";\nimport { ChartHeader, ChartFooter, ChartContainer } from \"../housing/availableUnits\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class Concern extends React.Component {\n  constructor() {\n    super(...arguments);\n\n    this.componentDidMount = () => {\n      this.drawConcern();\n    };\n\n    this.componentDidUpdate = () => {\n      d3.select(\"svg\").remove();\n      this.drawConcern();\n    };\n\n    this.drawConcern = () => {\n      //set svg size\n      let w = 1000;\n      let h = 500;\n      let padding = 20;\n      let leftMargin = 400;\n      let dataset = [],\n          xScale,\n          yScale,\n          xAxis,\n          yAxis; //loading data from csv file\n\n      d3.csv(concernData).then(data => {\n        dataset = data;\n        dataset.sort((a, b) => a.yes - b.yes); //construct a band scale with specified domain and range\n\n        yScale = d3.scaleBand().domain(dataset.map(d => d.var_label)).range([h - padding, padding]).paddingInner(0.8); //construct a continuous scale with specified domain and range\n\n        xScale = d3.scaleLinear().domain([0, 0.8]).range([leftMargin, w - padding]); //construct a left-oriented axis generator for the given scale\n\n        yAxis = d3.axisLeft().scale(yScale); //construct a top-oriented axis generator for the given scale\n\n        xAxis = d3.axisTop().scale(xScale).tickFormat(d3.format(\".0%\")).ticks(5); //create svg element\n\n        let svg = d3.select(this.props.concernRef.current).append(\"svg\").attr(\"width\", w).attr(\"height\", h); //create rect element and load dataset\n\n        let rect = svg.selectAll(\"rect\").data(dataset).enter().append(\"rect\");\n        rect.attr(\"x\", leftMargin).attr(\"y\", d => yScale(d.var_label)).attr(\"width\", 0).attr(\"height\", yScale.bandwidth()).attr(\"fill\", d => \"#a8ddb5\").transition().duration(700).delay((d, i) => i * 300).attr(\"width\", d => xScale(d.yes / d.total_participants) - leftMargin); //Create axis-x and axis-y\n\n        svg.append(\"g\").attr(\"class\", \"axis-x-concern\").attr(\"transform\", `translate(0, ${padding})`).attr(\"color\", \"#555\").call(xAxis).selectAll(\"text\").attr(\"font-size\", \"15px\").attr(\"color\", \"#000\");\n        svg.append(\"g\").attr(\"class\", \"axis-y-concern\").attr(\"transform\", `translate(${leftMargin}, 0)`).attr(\"color\", \"#555\").call(yAxis).selectAll(\"text\").attr(\"font-size\", \"15px\").attr(\"color\", \"#000\"); //define sortBars function to sort bars \n\n        let sortOrder = false;\n\n        const sortBars = () => {\n          sortOrder = !sortOrder;\n          dataset.sort((a, b) => sortOrder ? b.yes - a.yes : a.yes - b.yes);\n          console.log(dataset);\n          yScale.domain(dataset.map(d => d.var_label));\n          d3.select(\".axis-y-concern\").transition(\"yAxis\").delay((d, i) => i * 10).duration(500).call(yAxis);\n          rect.transition(\"sortBars\").delay((d, i) => i * 10).duration(500).attr(\"y\", d => yScale(d.var_label));\n        }; //define event listeners for click, mouseover, mouseout\n\n\n        rect.on(\"click\", () => sortBars()).on(\"mouseover\", (event, d) => {\n          d3.select(event.currentTarget).attr(\"fill\", \"#fd8d3c\");\n          d3.select(\"#concern\").style(\"left\", event.pageX + \"px\").style(\"top\", event.pageY + \"px\").select(\"#value\").text(d3.format(\".1%\")(d.yes / d.total_participants));\n          d3.select(\"#concern\").select(\"#year\").text(d.var_label);\n          d3.select(\"#concern\").classed(\"hidden\", false);\n        }).on(\"mouseout\", (event, d) => {\n          d3.select(event.currentTarget).transition(\"restoreBarColor\").duration(250).attr(\"fill\", d => \"#a8ddb5\");\n          d3.select(\"#concern\").classed(\"hidden\", true);\n        });\n      }).catch(error => {\n        console.log(error);\n      });\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"concern-units\",\n      style: {\n        display: this.props.selectedStatsID === 2 ? \"block\" : \"none\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(ChartHeader, {\n        chartTitle: \"What are the safety concerns in the community?\",\n        dotColor: \"#a8ddb5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(ChartContainer, {\n        containerRef: this.props.concernRef,\n        tooltipID: \"concern\",\n        tooltipValueTitle: \"percentage\",\n        tooltipOption: \"change\",\n        display: \"none\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(ChartFooter, {\n        chartSource: \"2020 Resident Survey.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"names":["React","d3","concernData","ChartHeader","ChartFooter","ChartContainer","Concern","Component","componentDidMount","drawConcern","componentDidUpdate","select","remove","w","h","padding","leftMargin","dataset","xScale","yScale","xAxis","yAxis","csv","then","data","sort","a","b","yes","scaleBand","domain","map","d","var_label","range","paddingInner","scaleLinear","axisLeft","scale","axisTop","tickFormat","format","ticks","svg","props","concernRef","current","append","attr","rect","selectAll","enter","bandwidth","transition","duration","delay","i","total_participants","call","sortOrder","sortBars","console","log","on","event","currentTarget","style","pageX","pageY","text","classed","catch","error","render","display","selectedStatsID"],"sources":["/Users/yupenglei/Documents/wrk-dashboard-light/src/component/safety/concern.js"],"sourcesContent":["import React from \"react\";\nimport * as d3 from \"d3\";\nimport concernData from \"../../data/safety_WRK_survey_2021.csv\";\nimport { ChartHeader, ChartFooter, ChartContainer } from \"../housing/availableUnits\";\n\nexport default class Concern extends React.Component {\n\n    componentDidMount = () => {\n        this.drawConcern();\n    }\n\n    componentDidUpdate = () => {\n        d3.select(\"svg\").remove();\n        this.drawConcern();\n    }\n\n    drawConcern = () => {\n        //set svg size\n        let w = 1000;\n        let h = 500;\n        let padding = 20;\n        let leftMargin = 400;\n\n\n        let dataset = [], xScale, yScale, xAxis, yAxis;\n        //loading data from csv file\n        d3.csv(concernData).then(data => {  \n\n            dataset = data;\n            dataset.sort((a, b) => a.yes - b.yes);\n\n            //construct a band scale with specified domain and range\n            yScale = d3.scaleBand()\n                        .domain(dataset.map(d => d.var_label))\n                        .range([h - padding, padding])\n                        .paddingInner(0.8);\n                                \n            //construct a continuous scale with specified domain and range\n            xScale = d3.scaleLinear()\n                        .domain([0, 0.8])\n                        .range([leftMargin, w - padding])                                       \n\n            //construct a left-oriented axis generator for the given scale\n            yAxis = d3.axisLeft()\n                        .scale(yScale);\n\n            //construct a top-oriented axis generator for the given scale\n            xAxis = d3.axisTop()\n                        .scale(xScale)\n                        .tickFormat(d3.format(\".0%\"))\n                        .ticks(5);                            \n            \n            //create svg element\n            let svg = d3.select(this.props.concernRef.current)\n                        .append(\"svg\")\n                        .attr(\"width\", w)\n                        .attr(\"height\", h);  \n\n            //create rect element and load dataset\n            let rect = svg.selectAll(\"rect\")\n                            .data(dataset)\n                            .enter()\n                            .append(\"rect\");\n\n            rect.attr(\"x\", leftMargin)\n                .attr(\"y\", d => yScale(d.var_label))\n                .attr(\"width\", 0)\n                .attr(\"height\", yScale.bandwidth())\n                .attr(\"fill\", d => \"#a8ddb5\")\n                .transition()\n                    .duration(700)\n                    .delay((d, i) => i * 300)\n                    .attr(\"width\", d => xScale(d.yes / d.total_participants) - leftMargin);\n\n\n            //Create axis-x and axis-y\n            svg.append(\"g\")\n                .attr(\"class\", \"axis-x-concern\")\n                .attr(\"transform\", `translate(0, ${padding})`)\n                .attr(\"color\", \"#555\")\n                .call(xAxis)\n                .selectAll(\"text\")\n                .attr(\"font-size\", \"15px\")\n                .attr(\"color\", \"#000\")\n     \n            svg.append(\"g\")\n                .attr(\"class\", \"axis-y-concern\")\n                .attr(\"transform\", `translate(${leftMargin}, 0)`)\n                .attr(\"color\", \"#555\")\n                .call(yAxis)\n                .selectAll(\"text\")\n                .attr(\"font-size\", \"15px\")\n                .attr(\"color\", \"#000\");\n\n\n            //define sortBars function to sort bars \n            let sortOrder = false;\n            const sortBars = () => {\n                sortOrder = !sortOrder; \n                dataset.sort((a, b) => sortOrder ? b.yes - a.yes : a.yes - b.yes);\n                console.log(dataset)\n                yScale.domain(dataset.map(d => d.var_label));\n\n                d3.select(\".axis-y-concern\")\n                    .transition(\"yAxis\")\n                    .delay((d, i) => i * 10)\n                    .duration(500)\n                    .call(yAxis);\n\n                rect.transition(\"sortBars\")\n                    .delay((d, i) => i * 10)\n                    .duration(500)\n                    .attr(\"y\", d => yScale(d.var_label));\n\n            }\n\n            //define event listeners for click, mouseover, mouseout\n            rect.on(\"click\", () => sortBars())\n                .on(\"mouseover\", (event, d) => {\n\n                        d3.select(event.currentTarget)\n                            .attr(\"fill\", \"#fd8d3c\");\n\n                        d3.select(\"#concern\")\n                            .style(\"left\", event.pageX + \"px\")\n                            .style(\"top\", event.pageY + \"px\")\n                            .select(\"#value\")\n                            .text(d3.format(\".1%\")(d.yes / d.total_participants));\n\n                        d3.select(\"#concern\")\n                            .select(\"#year\")\n                            .text(d.var_label);\n                            \n                        d3.select(\"#concern\").classed(\"hidden\", false);\n\n                    })\n                    .on(\"mouseout\", (event, d) => {\n                        d3.select(event.currentTarget)\n                            .transition(\"restoreBarColor\")\n                            .duration(250)\n                            .attr(\"fill\",  d => \"#a8ddb5\");\n\n                        d3.select(\"#concern\").classed(\"hidden\", true);\n                    });\n            \n\n        }).catch((error) => {\n            console.log(error);\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"concern-units\" style={{display: this.props.selectedStatsID === 2 ? \"block\" : \"none\"}} >\n                <ChartHeader \n                    chartTitle=\"What are the safety concerns in the community?\"\n                    dotColor=\"#a8ddb5\"\n                />\n                <ChartContainer \n                    containerRef={this.props.concernRef} \n                    tooltipID=\"concern\"\n                    tooltipValueTitle=\"percentage\"\n                    tooltipOption=\"change\"\n                    display=\"none\"\n                />\n                <ChartFooter chartSource=\"2020 Resident Survey.\" />\n            </div>\n        );\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}